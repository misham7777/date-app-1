(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[745],{1847:(e,r,s)=>{"use strict";s.d(r,{A:()=>o});var t=s(2115);let a=e=>{let r=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,r,s)=>s?s.toUpperCase():r.toLowerCase());return r.charAt(0).toUpperCase()+r.slice(1)},n=function(){for(var e=arguments.length,r=Array(e),s=0;s<e;s++)r[s]=arguments[s];return r.filter((e,r,s)=>!!e&&""!==e.trim()&&s.indexOf(e)===r).join(" ").trim()};var c={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let i=(0,t.forwardRef)((e,r)=>{let{color:s="currentColor",size:a=24,strokeWidth:i=2,absoluteStrokeWidth:o,className:l="",children:d,iconNode:h,...u}=e;return(0,t.createElement)("svg",{ref:r,...c,width:a,height:a,stroke:s,strokeWidth:o?24*Number(i)/Number(a):i,className:n("lucide",l),...!d&&!(e=>{for(let r in e)if(r.startsWith("aria-")||"role"===r||"title"===r)return!0})(u)&&{"aria-hidden":"true"},...u},[...h.map(e=>{let[r,s]=e;return(0,t.createElement)(r,s)}),...Array.isArray(d)?d:[d]])}),o=(e,r)=>{let s=(0,t.forwardRef)((s,c)=>{let{className:o,...l}=s;return(0,t.createElement)(i,{ref:c,iconNode:r,className:n("lucide-".concat(a(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),o),...l})});return s.displayName=a(e),s}},2416:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>f});var t=s(5155),a=s(2115),n=s(3209),c=s(7003),i=s(9235),o=s(1847);let l=(0,o.A)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]),d=(0,o.A)("target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),h=(0,o.A)("trending-down",[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]]);var u=s(6983);function m(){let[e,r]=(0,a.useState)({searches:[],funnelAnalytics:[],dropOffs:[]}),[s,o]=(0,a.useState)(!0),[m,f]=(0,a.useState)({start:new Date(Date.now()-6048e5).toISOString().split("T")[0],end:new Date().toISOString().split("T")[0]});(0,a.useEffect)(()=>{p()},[m]);let p=async()=>{o(!0);try{let[e,s,t]=await Promise.all([(0,i.JY)(m),(0,i.zv)(m),(0,i.Ml)(m)]);r({searches:t||[],funnelAnalytics:e||[],dropOffs:s||[]})}catch(e){console.error("Error loading search analytics:",e)}finally{o(!1)}},x=e.searches.length,_=e.searches.filter(e=>e.is_completed).length,g=x>0?((x-_)/x*100).toFixed(1):"0",j=e.dropOffs.reduce((e,r)=>{let s=r.step_name;return e[s]=(e[s]||0)+1,e},{});return s?(0,t.jsx)("div",{className:"p-6",children:(0,t.jsx)("div",{className:"text-center",children:"Loading search analytics..."})}):(0,t.jsxs)("div",{className:"p-6 space-y-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold",children:"Search Analytics Dashboard"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("input",{type:"date",value:m.start,onChange:e=>f(r=>({...r,start:e.target.value})),className:"border rounded px-3 py-2"}),(0,t.jsx)("input",{type:"date",value:m.end,onChange:e=>f(r=>({...r,end:e.target.value})),className:"border rounded px-3 py-2"}),(0,t.jsx)(c.$,{onClick:p,children:"Refresh"})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,t.jsxs)(n.Zp,{children:[(0,t.jsxs)(n.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(n.ZB,{className:"text-sm font-medium",children:"Total Searches"}),(0,t.jsx)(l,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(n.Wu,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:x}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["From ",m.start," to ",m.end]})]})]}),(0,t.jsxs)(n.Zp,{children:[(0,t.jsxs)(n.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(n.ZB,{className:"text-sm font-medium",children:"Completed Searches"}),(0,t.jsx)(d,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(n.Wu,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:_}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:[x>0?(_/x*100).toFixed(1):"0","% completion rate"]})]})]}),(0,t.jsxs)(n.Zp,{children:[(0,t.jsxs)(n.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(n.ZB,{className:"text-sm font-medium",children:"Drop-off Rate"}),(0,t.jsx)(h,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(n.Wu,{children:[(0,t.jsxs)("div",{className:"text-2xl font-bold",children:[g,"%"]}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:[x-_," users dropped off"]})]})]}),(0,t.jsxs)(n.Zp,{children:[(0,t.jsxs)(n.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(n.ZB,{className:"text-sm font-medium",children:"Avg Time"}),(0,t.jsx)(u.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(n.Wu,{children:[(0,t.jsxs)("div",{className:"text-2xl font-bold",children:[e.dropOffs.length>0?Math.round(e.dropOffs.reduce((e,r)=>e+(r.time_spent_seconds||0),0)/e.dropOffs.length):0,"s"]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Average time before drop-off"})]})]})]}),(0,t.jsxs)(n.Zp,{children:[(0,t.jsx)(n.aR,{children:(0,t.jsx)(n.ZB,{children:"Drop-off Analysis by Step"})}),(0,t.jsx)(n.Wu,{children:(0,t.jsx)("div",{className:"space-y-4",children:Object.entries(j).map(e=>{let[r,s]=e;return(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium capitalize",children:r.replace("_"," ")}),(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:[s," drop-offs"]})]}),(0,t.jsx)("div",{className:"text-right",children:(0,t.jsxs)("div",{className:"font-bold",children:[x>0?(s/x*100).toFixed(1):"0","%"]})})]},r)})})})]}),(0,t.jsxs)(n.Zp,{children:[(0,t.jsx)(n.aR,{children:(0,t.jsx)(n.ZB,{children:"Recent Searches"})}),(0,t.jsx)(n.Wu,{children:(0,t.jsx)("div",{className:"space-y-4",children:e.searches.slice(0,10).map(e=>(0,t.jsxs)("div",{className:"flex justify-between items-center p-3 border rounded",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium",children:e.name}),(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:[e.email," • ",e.search_type," • ",new Date(e.created_at).toLocaleDateString()]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("div",{className:"text-sm font-medium ".concat(e.is_completed?"text-green-600":"text-red-600"),children:e.is_completed?"Completed":"Dropped off"}),(0,t.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Step ",e.current_step||1]})]})]},e.id))})})]}),(0,t.jsxs)(n.Zp,{children:[(0,t.jsx)(n.aR,{children:(0,t.jsx)(n.ZB,{children:"Search Type Distribution"})}),(0,t.jsx)(n.Wu,{children:(0,t.jsx)("div",{className:"space-y-4",children:Object.entries(e.searches.reduce((e,r)=>{let s=r.search_type||"partner";return e[s]=(e[s]||0)+1,e},{})).map(e=>{let[r,s]=e;return(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium capitalize",children:r}),(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:[s," searches"]})]}),(0,t.jsx)("div",{className:"text-right",children:(0,t.jsxs)("div",{className:"font-bold",children:[x>0?(s/x*100).toFixed(1):"0","%"]})})]},r)})})})]})]})}function f(){return(0,t.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,t.jsx)(m,{})})}},9192:(e,r,s)=>{Promise.resolve().then(s.bind(s,2416))},9235:(e,r,s)=>{"use strict";s.d(r,{Ar:()=>c,Do:()=>n,JY:()=>l,Ml:()=>h,WF:()=>o,oW:()=>i,zv:()=>d});var t=s(8593);class a{getOrCreateSessionId(){let e=localStorage.getItem("search_session_id");return e||(e="session_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),localStorage.setItem("search_session_id",e)),e}getDeviceInfo(){return{user_agent:navigator.userAgent,referrer:document.referrer,utm_source:new URLSearchParams(window.location.search).get("utm_source"),utm_medium:new URLSearchParams(window.location.search).get("utm_medium"),utm_campaign:new URLSearchParams(window.location.search).get("utm_campaign")}}async trackSearch(e){try{let r=this.getDeviceInfo(),{data:s,error:a}=await t.ND.from("searches").insert([{session_id:e.session_id,name:e.name,email:e.email,search_type:e.search_type||"partner",source_page:e.source_page||"home",user_agent:e.user_agent||r.user_agent,referrer:e.referrer||r.referrer,utm_source:e.utm_source||r.utm_source,utm_medium:e.utm_medium||r.utm_medium,utm_campaign:e.utm_campaign||r.utm_campaign,current_step:1,total_steps:3,started_at:new Date().toISOString(),last_activity_at:new Date().toISOString()}]).select("id").single();if(a)return console.error("Error tracking search:",a),null;return s.id}catch(e){return console.error("Error tracking search:",e),null}}async updateSearchSession(e){try{let{error:r}=await t.ND.from("searches").update({current_step:e.current_step,last_activity_at:new Date().toISOString(),completed_at:e.completed_at,dropped_off_at:e.dropped_off_at,drop_off_step:e.drop_off_step,drop_off_reason:e.drop_off_reason,is_completed:e.is_completed}).eq("session_id",this.sessionId);if(r)return console.error("Error updating search session:",r),!1;return!0}catch(e){return console.error("Error updating search session:",e),!1}}async trackSearchAnswer(e){try{let{data:r}=await t.ND.from("searches").select("id").eq("session_id",this.sessionId).single(),{error:s}=await t.ND.from("search_answers").insert([{search_id:null==r?void 0:r.id,session_id:e.session_id,step_number:e.step_number,question_type:e.question_type,answer_data:e.answer_data}]);if(s)return console.error("Error tracking search answer:",s),!1;return await this.updateSearchSession({current_step:e.step_number+1,last_activity_at:new Date().toISOString()}),!0}catch(e){return console.error("Error tracking search answer:",e),!1}}async trackSearchDropOff(e){try{let{data:r}=await t.ND.from("searches").select("id").eq("session_id",this.sessionId).single(),s=this.getDeviceInfo(),{error:a}=await t.ND.from("search_drop_offs").insert([{search_id:null==r?void 0:r.id,session_id:e.session_id,step_number:e.step_number,step_name:e.step_name,drop_off_reason:e.drop_off_reason,time_spent_seconds:e.time_spent_seconds,user_agent:e.user_agent||s.user_agent,ip_address:e.ip_address}]);if(a)return console.error("Error tracking search drop-off:",a),!1;return await this.updateSearchSession({dropped_off_at:new Date().toISOString(),drop_off_step:e.step_number,drop_off_reason:e.drop_off_reason}),!0}catch(e){return console.error("Error tracking search drop-off:",e),!1}}async completeSearchSession(){try{let{error:e}=await t.ND.from("searches").update({is_completed:!0,completed_at:new Date().toISOString(),last_activity_at:new Date().toISOString()}).eq("session_id",this.sessionId);if(e)return console.error("Error completing search session:",e),!1;return!0}catch(e){return console.error("Error completing search session:",e),!1}}async getSearchFunnelAnalytics(e){try{let{data:r,error:s}=await t.ND.from("search_funnel_analytics").select("*").gte("date",e.start).lte("date",e.end).order("date",{ascending:!1});if(s)return console.error("Error getting search funnel analytics:",s),null;return r}catch(e){return console.error("Error getting search funnel analytics:",e),null}}async getSearchDropOffAnalysis(e){try{let{data:r,error:s}=await t.ND.from("search_drop_offs").select("\n          *,\n          searches!inner(session_id, name, email)\n        ").gte("created_at",e.start).lte("created_at",e.end).order("created_at",{ascending:!1});if(s)return console.error("Error getting search drop-off analysis:",s),null;return r}catch(e){return console.error("Error getting search drop-off analysis:",e),null}}async getSearchesWithProgress(e){try{let{data:r,error:s}=await t.ND.from("searches").select("\n          *,\n          search_answers(*)\n        ").gte("created_at",e.start).lte("created_at",e.end).order("created_at",{ascending:!1});if(s)return console.error("Error getting searches with progress:",s),null;return r}catch(e){return console.error("Error getting searches with progress:",e),null}}async getAllSearches(){try{let{data:e,error:r}=await t.ND.from("searches").select("*").order("created_at",{ascending:!1});if(r)return console.error("Error getting all searches:",r),null;return e}catch(e){return console.error("Error getting all searches:",e),null}}constructor(){this.sessionId=this.getOrCreateSessionId()}}let n=new a,c=e=>n.trackSearch(e),i=e=>n.trackSearchAnswer(e),o=()=>n.completeSearchSession(),l=e=>n.getSearchFunnelAnalytics(e),d=e=>n.getSearchDropOffAnalysis(e),h=e=>n.getSearchesWithProgress(e)}},e=>{e.O(0,[40,909,25,441,255,358],()=>e(e.s=9192)),_N_E=e.O()}]);